<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COVID-19 Tracker</title>

    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.7.0/fonts/remixicon.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="./assets/css/style.css">
</head>

<body>

    <section class="p-sm-0 p-4">
        <div class="container">
            <div class="text-center py-5">
                <h1 class="app-title">
                    <i class="ri-virus-fill"></i>
                    COVID-19 India Tracker
                </h1>
            </div>
            <div class="row justify-content-center">
                <div class="col-xl-6 col-lg-8">
                    <div class="search-box mb-4">
                        <input type="text" id="ctName" placeholder="Enter state (e.g. Gujarat)" autocomplete="off">
                        <button class="btn-search" id="getBtn"><i class="ri-search-2-line"></i> Search</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="container" id="content-container">

        </div>
    </section>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const COVID_API = "https://api.rootnet.in/covid19-in/stats/latest";

        async function getStats() {
            let ctName = document.getElementById("ctName").value.toLowerCase();

            try {
                const res = await fetch(COVID_API);
                if (res.status === 404) {
                    throw new Error("State not found or data unavailable");
                    return;
                }

                const data = await res.json();

                let stateArr = data.data.regional;

                let state = stateArr.find((state) => {
                    return state.loc.toLowerCase() === ctName;
                })

                document.getElementById("content-container").innerHTML = `
                    <div class="row justify-content-center mb-5">
                        <div class="col-xl-6 col-lg-8">
                            <div class="result-card p-4">
                                <h3 class="text-center text-capitalize mt-2 mb-4">
                                    <i class="ri-map-pin-2-fill"></i>
                                    ${ctName}
                                </h3>
                                <div class="row gy-4">
                                    <div class="col-12">
                                        <div class="stat-card px-4 py-3">
                                            <p class="mb-1"><i class="ri-virus-line me-1"></i>Total Cases</p>
                                            <h2>${state.totalConfirmed}</h2>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="stat-card px-4 py-3">
                                            <p class="mb-1"><i class="ri-shield-check-fill me-1"></i>Discharged</p>
                                            <h2>${state.discharged}</h2>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="stat-card px-4 py-3">
                                            <p class="mb-1"><i class="ri-service-fill me-1"></i>Deaths</p>
                                            <h2>${state.deaths}</h2>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } catch (err) {
                document.getElementById("content-container").innerHTML = `
                    <div class="row justify-content-center">
                        <div class="col-xl-6 col-lg-8">
                            <div class="error-card text-center">
                                <h2>State Not Found</h2>
                                <p class="m-0">Please enter a valid state name</p>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        document.getElementById("getBtn").addEventListener("click", function () {
            getStats();
        })
    </script>
</body>

</html>
